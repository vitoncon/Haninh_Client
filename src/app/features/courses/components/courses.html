<!-- Statistics Cards -->
<div class="statistics-cards-grid" *ngIf="statistics">
  <p-card>
    <div class="flex align-items-center">
      <div class="flex-1">
        <h6>Tổng khóa học</h6>
        <h4>{{ statistics.total_courses }}</h4>
      </div>
      <i class="pi pi-graduation-cap text-blue-500 text-2xl"></i>
    </div>
  </p-card>

  <p-card>
    <div class="flex align-items-center">
      <div class="flex-1">
        <h6>Đang hoạt động</h6>
        <h4>{{ statistics.active_courses }}</h4>
      </div>
      <i class="pi pi-check-circle text-green-500 text-2xl"></i>
    </div>
  </p-card>

  <p-card>
    <div class="flex align-items-center">
      <div class="flex-1">
        <h6>Không hoạt động</h6>
        <h4>{{ statistics.inactive_courses }}</h4>
      </div>
      <i class="pi pi-times-circle text-red-500 text-2xl"></i>
    </div>
  </p-card>

  <p-card>
    <div class="flex align-items-center">
      <div class="flex-1">
        <h6>Học phí TB</h6>
        <h4>{{ formatCurrency(statistics.average_tuition_fee) }}</h4>
      </div>
      <i class="pi pi-money-bill text-orange-500 text-2xl"></i>
    </div>
  </p-card>
</div>

<div class="page-card">

<!-- Toolbar -->
<p-toolbar *ngIf="!loading && courses.length > 0">
  <ng-template pTemplate="start">
    <button
      pButton
      label="Làm mới"
      icon="pi pi-refresh"
      class="p-button-outlined"
      (click)="forceRefresh()">
    </button>
  </ng-template>

  <ng-template pTemplate="center">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input
        pInputText
        type="text"
        placeholder="Tìm kiếm..."
        [(ngModel)]="searchQuery"
        (input)="onGlobalFilter($event)">
    </span>
    <i
      *ngIf="searchQuery"
      class="pi pi-times ml-2 cursor-pointer"
      (click)="clearSearch()">
    </i>
  </ng-template>

  <ng-template pTemplate="end">
    <button
      pButton
      label="Tạo khóa học"
      icon="pi pi-plus"
      (click)="onCreate()">
    </button>
  </ng-template>
</p-toolbar>

<!-- Drawer -->
<p-drawer
  header="Thêm / Sửa khóa học"
  [(visible)]="drawerVisible"
  position="right"
  [modal]="true"
  [style]="{ width: '600px' }"
  (onHide)="onDrawerHide()">

  <div class="form-grid p-fluid" *ngIf="formCourse">

    <div class="form-group">
      <label>Mã KH *</label>
      <input
        pInputText
        [(ngModel)]="formCourse.course_code"
        [readonly]="selectedCourse?.id">
    </div>

    <div class="form-group">
      <label>Tên khóa học *</label>
      <input pInputText [(ngModel)]="formCourse.course_name">
    </div>

    <div class="form-group full-width">
      <label>Mô tả</label>
      <textarea pInputTextarea [(ngModel)]="formCourse.description"></textarea>
    </div>

    <div class="form-group">
      <label>Danh mục</label>
      <p-dropdown
        [(ngModel)]="formCourse.category"
        [options]="['Giao tiếp','Ngữ pháp','Từ vựng','Phát âm','Luyện thi','Khác']">
      </p-dropdown>
    </div>

    <div class="form-group">
      <label>Ngôn ngữ</label>
      <p-dropdown
        [(ngModel)]="formCourse.language"
        [options]="['Tiếng Anh','Tiếng Hàn','Tiếng Trung']">
      </p-dropdown>
    </div>

    <div class="form-group">
      <label>Trình độ</label>
      <p-dropdown
        [(ngModel)]="formCourse.level"
        [options]="['Sơ cấp','Trung cấp','Cao cấp']">
      </p-dropdown>
    </div>

    <div class="form-group">
      <label>Số tuần</label>
      <p-inputNumber [(ngModel)]="formCourse.duration_weeks"></p-inputNumber>
    </div>

    <div class="form-group">
      <label>Tổng giờ</label>
      <p-inputNumber [(ngModel)]="formCourse.total_hours"></p-inputNumber>
    </div>

    <div class="form-group">
      <label>Học phí</label>
      <p-inputNumber
        [(ngModel)]="formCourse.tuition_fee"
        mode="currency"
        currency="VND">
      </p-inputNumber>
    </div>

    <div class="form-group full-width">
      <label>Trạng thái</label>
      <p-dropdown
        [(ngModel)]="formCourse.status"
        [options]="['Đang hoạt động','Không hoạt động']">
      </p-dropdown>
    </div>

  </div>

  <div class="dialog-actions">
    <button pButton label="Hủy" class="p-button-text" (click)="drawerVisible=false"></button>
    <button pButton label="Lưu" (click)="onSave()" [disabled]="!formCourse?.course_name"></button>
  </div>
</p-drawer>

<!-- Table -->
<p-table
  *ngIf="!loading && courses.length > 0"
  [value]="filteredCourses"
  [paginator]="true"
  [rows]="5">

  <ng-template pTemplate="header">
    <tr>
      <th>Mã KH</th>
      <th>Tên khóa học</th>
      <th>Ngôn ngữ</th>
      <th>Trình độ</th>
      <th>Học phí</th>
      <th>Trạng thái</th>
      <th>Hành động</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-course>
    <tr>
      <td>{{ course.course_code }}</td>
      <td>{{ course.course_name }}</td>
      <td>{{ course.language }}</td>
      <td>{{ course.level }}</td>
      <td>{{ course.tuition_fee | currency:'VND' }}</td>
      <td>{{ course.status }}</td>
      <td>
        <button pButton icon="pi pi-eye" class="p-button-text" (click)="onView(course)"></button>
        <button pButton icon="pi pi-pencil" class="p-button-text" (click)="onEdit(course)"></button>
        <button pButton icon="pi pi-trash" class="p-button-text p-button-danger" (click)="onDelete(course)"></button>
      </td>
    </tr>
  </ng-template>

</p-table>

<p-confirmDialog></p-confirmDialog>
</div>
